# vim:tw=0:ts=2:sw=2:et:norl:nospell:ft=config

lib =
  link_private_exclude () {
    local private_excl_f
    # Use readlink to clean up the path (e.g., remove duplicate separators).
    # REMEMBER: Note that Home Fries, a public repo, assumes you (the user)
    # also maintain a private repo, conventionally found at (or symlinked from)
    # ~/.curly (as in, Curly Fries). Within that directory, well, it's not well
    # defined, or at least Home Fries doesn't care about what you keep there
    # (see: ~/.fries/lib/curly_util.sh for what Home Fries does care about).
    # One of the few expectations is that under ~/.curly/infusers is a hierarchy
    # of directories that matches your local filesystem hierarchy, starting at /
    # (root), that contains .git/info/exclude files you'd like installed. For
    # instance, the exclude for home-fries is found at:
    #   ~/.curly/infusers/home/user/_git/info/exclude
    # Note that the .git/ directory is mirrored as _git, because git will not
    # let you add files from under a directory named .git/.
    private_excl_f=$(readlink -m "${ZP_HOME:-${HOME}}/.curly/infusers/${MR_REPO}/_git/info/exclude")
    if [ ! -f "${private_excl_f}" ]; then
      error "Repo says it wires its own private git exclude file, but none found at: “${private_excl_f}”"
      return 1
    fi
    /bin/ln -sf .git/info/exclude .gitignore.local
    cd .git/info
    # CAREFUL: This clobbers!
    /bin/ln -sf ${private_excl_f} exclude
    info "Wired!"
  }

# MEH: myrepos splits on {\w} but treats underscores specially,
#   so we can only use letters and numbers in action names. Bah.
# Default is no-op. Return true so myrepos does not think it failed.
wireexcludes = true

